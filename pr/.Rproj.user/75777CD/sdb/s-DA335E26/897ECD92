{
    "collab_server" : "",
    "contents" : "library(data.table)\n\nrho_ci2 <- function(x, lags=0, level = c(\"0.95\", \"0.90\", \"0.80\"), max_lags = 8) {\n\n  level <- match.arg(level)\n\n  # load tables\n  switch(level,\n         \"0.95\" = df <- pr::df_gls95,\n         \"0.90\" = df <- pr::df_gls90,\n         \"0.80\"  = df <- pr::df_gls80)\n\n\n  N <- length(x)\n\n  rho_gls <- 1-7/(N-1)\n  y <- x - c(0,rho_gls*x[1:(N-1)])\n  x_prime <- c(1,rep(1-rho_gls, (N-1)))\n\n  # estimate linear model without intercept\n  lm_mugls <- lm(y~x_prime -1)\n  smry_mugls <- summary(lm_mugls)\n\n  mu_gls <- smry_mugls$coefficients[1,1]\n  x_bar <-  x - mu_gls\n  x_bar_diff <- c(NA, diff(x_bar))\n\n  if (lags==1){\n    X <- x_bar_diff\n    X <- cbind(X, shift(x_bar, n=1, fill=NA, type=\"lag\"))\n    opt_lags <- lags\n    X <- na.omit(X)\n\n    # estimate linear model without intercept\n    lm_dfgls <- lm( X[,1]~ X[,-1]  -1)\n    smry_dfgls <- summary(lm_dfgls)\n    df_gls <- smry_dfgls$coefficients[1,\"t value\"]\n\n\n  }else if (lags>1){\n    X <- x_bar_diff\n    X <- cbind(X, shift(x_bar, n=1, fill=NA, type=\"lag\"))\n    opt_lags <- lags\n    for (lag in 1:(lags-1)){\n      X <- cbind(X, shift(x_bar_diff, n=lag, fill=NA, type=\"lag\"))\n\n    }\n    X <- na.omit(X)\n\n    # estimate linear model without intercept\n    lm_dfgls <- lm( X[,1]~ X[,-1]  -1)\n    smry_dfgls <- summary(lm_dfgls)\n    df_gls <- smry_dfgls$coefficients[1,\"t value\"]\n\n  }else{\n    bic_list <- NULL\n    lag_list <- NULL\n    df_gls_list <- NULL\n\n    for (i in 1:max_lags){\n      X <- x_bar_diff\n      X <- cbind(X, shift(x_bar, n=1, fill=NA, type=\"lag\"))\n      if (i>1){\n        for (lag in 1:(i-1)){\n          X <- cbind(X, shift(x_bar_diff, n=lag, fill=NA, type=\"lag\"))\n         }\n      }\n      X <- na.omit(X)\n\n      # estimate linear model without intercept\n      lm_dfgls <- lm( X[,1]~ X[,-1]  -1)\n      smry_dfgls <- summary(lm_dfgls)\n      df_gls <- smry_dfgls$coefficients[1,\"t value\"]\n      if (is.na(df_gls)){\n        stop('NA in DF-GLS encountered; reduce max_lags.')\n      }\n\n      bic_list <- c(bic_list, BIC(lm_dfgls))\n      lag_list <- c(lag_list, i)\n      df_gls_list <- c(df_gls_list, df_gls)\n\n\n\n    }\n    best_bic_index <- which.min(bic_list)\n    opt_lags <- lag_list[best_bic_index]\n    df_gls <- df_gls_list[best_bic_index]\n\n\n  }\n\n\n\n\n  table_df_gls <- as.numeric(row.names(df))\n  df_gls_lookup <- table_df_gls[which.min(abs(table_df_gls - c(df_gls)) )]\n\n\n  ci <- c(df[as.character(df_gls_lookup),1][[1]], df[as.character(df_gls_lookup),2][[1]])\n  ci_rho <- c(1+ci[[1]]/(N-opt_lags), 1+ci[[2]]/(N-opt_lags))\n\n  if (df_gls < (-5)){\n    warning(\"DF-GLS test statistic < -5: confidence intervals unreliable.\")}\n\n  return(c(ci_rho, ci, df_gls, opt_lags))\n}\n",
    "created" : 1560946286862.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2629468319",
    "id" : "897ECD92",
    "lastKnownWriteTime" : 1561135820,
    "last_content_update" : 1561135820889,
    "path" : "~/Desktop/PersistentRegressors/pr/R/rhoConfidenceInterval2.R",
    "project_path" : "R/rhoConfidenceInterval2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 17,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}